@page "/entries/{EntryId}/images/{ImageId}"
@inherits UserStateComponentBase

@if (Model != null)
{
    <DocumentTitle Value="@Model.Name" />

    <PermissionContainer State="@Permissions">
        <ActionMenu>
            <ItemGroup Text="@Model.Name">
                <Item Icon="cloud-download" Text="Download Original" OnClick="DownloadOriginalAsync" Title="Download Original Image" />
                <ShareLinkButton Layout="ButtonLayout.Item" />
                <PermissionView Request="PermissionRequest.Write">
                    <Item Icon="location-arrow" Text="Set Location from Original" OnClick="SetLocationOriginalAsync" Title="Set Location from Original Image" />
                    <Item Icon="trash-alt" Text="Delete Image" OnClick="DeleteAsync" CssClass="text-danger" Title="Delete Image" />
                </PermissionView>
            </ItemGroup>
        </ActionMenu>

        <div class="image-detail my-sm-3">
            <h2 class="title d-flex text-break">
                <InlineTextEdit Value="@Model.Name" PlaceHolder="Unnamed image..." ValueChanged="@(async value => await SaveNameAsync(value))" EditModeCssClass="flex-grow-1" />
            </h2>
            <div class="datetime">
                <InlineDateEdit Value="@Model.When" ValueChanged="@(async value => await SaveWhenAsync(value))" Format="@UiOptions.DateFormat" IsTimeSelection="true" />
            </div>
            @if (EntryId != null)
            {
                <InlineLink Icon="comment" Value="@EntryModel.Title" OnClick="@(() => Navigator.OpenEntryDetail(EntryId))" />
            }
            <UserInformation Owner="@Owner" />
            @if (UserState.IsAuthenticated)
            {
                <div class="gps">
                    <MapToggle ToggleChanged="@GetMapDescription" IsPlaceHolder="@(!Model.Location.HasValue())" IsEnabled="@(Model.Location.HasValue() || Permissions.IsEditable)">
                        <Neptuo.Recollections.Components.Map Markers="@Markers" MarkersChanged="@(async () => await SaveLocationAsync())" MarkerSelected="OnLocationSelected" OnClearLocation="@OnClearLocationAsync" />
                    </MapToggle>
                </div>
            }
            <div class="my-3">
                <InlineMarkdownEdit Value="@Model.Description" PlaceHolder="No description..." ValueChanged="@(async value => await SaveDescriptionAsync(value))" />
            </div>
            <EntryImage EntryId="@EntryId" Image="@Model" ImageType="@ImageType.Preview" />
        </div>

        <LocationEdit @ref="LocationEdit" Save="@(async location => await SaveLocationAsync(location))" Delete="@OnClearLocationAsync" />
    </PermissionContainer>
}
